asyncapi: 2.6.0
info:
  title: Job Posted Events API
  version: 1.0.0
  description: |
    AsyncAPI specification for job posting events in the Multi-Agent Job Application System.
    This API defines the events that are published when jobs are created, updated, or deleted.

servers:
  kafka:
    url: localhost:9092
    protocol: kafka
    description: Kafka broker for job events

channels:
  job.events:
    description: Channel for job-related events
    publish:
      summary: Publish job events
      operationId: publishJobEvents
      message:
        oneOf:
          - $ref: "#/components/messages/JobCreated"
          - $ref: "#/components/messages/JobUpdated"
          - $ref: "#/components/messages/JobDeleted"
    subscribe:
      summary: Subscribe to job events
      operationId: subscribeToJobEvents
      message:
        oneOf:
          - $ref: "#/components/messages/JobCreated"
          - $ref: "#/components/messages/JobUpdated"
          - $ref: "#/components/messages/JobDeleted"

components:
  messages:
    JobCreated:
      name: JobCreated
      title: Job Created Event
      summary: Event published when a new job is created
      contentType: application/json
      payload:
        $ref: "#/components/schemas/JobCreatedEvent"
      examples:
        - name: Software Engineer Job
          summary: Example of a software engineer job creation
          payload:
            event_id: "evt_123456789"
            event_type: "job.created"
            timestamp: "2024-01-15T10:30:00Z"
            data:
              job_id: "job_001"
              title: "Senior Software Engineer"
              company: "TechCorp"
              location: "San Francisco, CA"
              description: "We are looking for a senior software engineer..."
              requirements:
                - "5+ years of experience in software development"
                - "Proficiency in Python, Go, or JavaScript"
                - "Experience with microservices architecture"
              skills:
                - "Python"
                - "Go"
                - "JavaScript"
                - "Docker"
                - "Kubernetes"
              experience_level: "senior"
              salary_range: "$120,000 - $180,000"
              job_type: "full-time"
              remote_friendly: true
              status: "active"

    JobUpdated:
      name: JobUpdated
      title: Job Updated Event
      summary: Event published when an existing job is updated
      contentType: application/json
      payload:
        $ref: "#/components/schemas/JobUpdatedEvent"
      examples:
        - name: Updated Job Requirements
          summary: Example of job requirements being updated
          payload:
            event_id: "evt_123456790"
            event_type: "job.updated"
            timestamp: "2024-01-15T14:45:00Z"
            data:
              job_id: "job_001"
              changes:
                requirements:
                  - "5+ years of experience in software development"
                  - "Proficiency in Python, Go, or JavaScript"
                  - "Experience with microservices architecture"
                  - "Knowledge of machine learning frameworks"
                skills:
                  - "Python"
                  - "Go"
                  - "JavaScript"
                  - "Docker"
                  - "Kubernetes"
                  - "TensorFlow"
                  - "PyTorch"
              previous_data:
                requirements:
                  - "5+ years of experience in software development"
                  - "Proficiency in Python, Go, or JavaScript"
                skills:
                  - "Python"
                  - "Go"
                  - "JavaScript"

    JobDeleted:
      name: JobDeleted
      title: Job Deleted Event
      summary: Event published when a job is deleted
      contentType: application/json
      payload:
        $ref: "#/components/schemas/JobDeletedEvent"
      examples:
        - name: Job Deletion
          summary: Example of a job being deleted
          payload:
            event_id: "evt_123456791"
            event_type: "job.deleted"
            timestamp: "2024-01-15T16:20:00Z"
            data:
              job_id: "job_001"
              reason: "Position filled"
              deleted_by: "user_123"

  schemas:
    JobCreatedEvent:
      type: object
      required:
        - event_id
        - event_type
        - timestamp
        - data
      properties:
        event_id:
          type: string
          description: Unique identifier for the event
          pattern: "^evt_[a-zA-Z0-9]+$"
        event_type:
          type: string
          enum: [job.created]
          description: Type of the event
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
        data:
          $ref: "#/components/schemas/JobData"
        metadata:
          type: object
          description: Additional metadata about the event
          properties:
            source:
              type: string
              description: Source system that generated the event
            version:
              type: string
              description: Version of the event schema

    JobUpdatedEvent:
      type: object
      required:
        - event_id
        - event_type
        - timestamp
        - data
      properties:
        event_id:
          type: string
          description: Unique identifier for the event
          pattern: "^evt_[a-zA-Z0-9]+$"
        event_type:
          type: string
          enum: [job.updated]
          description: Type of the event
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
        data:
          type: object
          required:
            - job_id
            - changes
          properties:
            job_id:
              type: string
              description: ID of the updated job
            changes:
              type: object
              description: Fields that were changed
              properties:
                title:
                  type: string
                company:
                  type: string
                location:
                  type: string
                description:
                  type: string
                requirements:
                  type: array
                  items:
                    type: string
                skills:
                  type: array
                  items:
                    type: string
                experience_level:
                  type: string
                salary_range:
                  type: string
                job_type:
                  type: string
                remote_friendly:
                  type: boolean
                status:
                  type: string
            previous_data:
              type: object
              description: Previous values of changed fields
        metadata:
          type: object
          description: Additional metadata about the event

    JobDeletedEvent:
      type: object
      required:
        - event_id
        - event_type
        - timestamp
        - data
      properties:
        event_id:
          type: string
          description: Unique identifier for the event
          pattern: "^evt_[a-zA-Z0-9]+$"
        event_type:
          type: string
          enum: [job.deleted]
          description: Type of the event
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
        data:
          type: object
          required:
            - job_id
          properties:
            job_id:
              type: string
              description: ID of the deleted job
            reason:
              type: string
              description: Reason for deletion
            deleted_by:
              type: string
              description: User or system that deleted the job
        metadata:
          type: object
          description: Additional metadata about the event

    JobData:
      type: object
      required:
        - job_id
        - title
        - company
        - location
        - description
        - requirements
        - skills
        - experience_level
        - job_type
        - remote_friendly
        - status
      properties:
        job_id:
          type: string
          description: Unique identifier for the job
          pattern: "^job_[a-zA-Z0-9]+$"
        title:
          type: string
          description: Job title
          minLength: 1
          maxLength: 200
        company:
          type: string
          description: Company name
          minLength: 1
          maxLength: 100
        location:
          type: string
          description: Job location
          minLength: 1
          maxLength: 100
        description:
          type: string
          description: Job description
          minLength: 1
          maxLength: 5000
        requirements:
          type: array
          description: List of job requirements
          items:
            type: string
            minLength: 1
          minItems: 1
        skills:
          type: array
          description: List of required skills
          items:
            type: string
            minLength: 1
          minItems: 1
        experience_level:
          type: string
          enum: [entry, junior, mid, senior, lead, principal]
          description: Required experience level
        salary_range:
          type: string
          description: Salary range (optional)
          maxLength: 100
        job_type:
          type: string
          enum: [full-time, part-time, contract, internship]
          description: Type of employment
        remote_friendly:
          type: boolean
          description: Whether the job supports remote work
        status:
          type: string
          enum: [active, inactive, filled, expired]
          description: Current status of the job
